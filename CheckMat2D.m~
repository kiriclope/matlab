function [] = CheckMat2D(model,nbpop,n,K,Sigma,IF_Nk,DisplayOn,IF_SAVE)
    L = pi ;
    SCALING = 1.5 ;

    N = n*10000 ;
    nbN = nbNeuron(nbpop,n,IF_Nk,[]) 
    Cpt = CptNeuron(nbpop,nbN) 

    sqrtNp = [ sqrt(nbN(1)) sqrt(nbN(2)) ] ;

    if(strfind(model,'IF'))
        if(length(Sigma)==1)
            str_Matrix = sprintf(['../IF/%dpop/Connectivity/N%d/K%d/Space2D/CrecI%.2f/Cij_Matrix.dat'],nbpop,n,K,Sigma) 
        elseif(length(Sigma)==2)
            if(length(K)==1)
                str_Matrix = sprintf(['../IF/%dpop/Connectivity/N%d/' ...
                                    'K%d/Space2D/CrecE%.2fCrecI%.2f/Cij_Matrix.dat'],nbpop,n,K,Sigma(1),Sigma(2)) 
            else
                str_Matrix = sprintf(['../IF/%dpop/Connectivity/N%d/' ...
                                    'KE%dKI%d/Space2D/CrecE%.2fCrecI%.2f/Cij_Matrix.dat'],nbpop,n,K(1),K(2),Sigma(1),Sigma(2)) 
            end
        elseif(length(Sigma)>=2)
            str_Matrix = sprintf(['../IF/%dpop/Connectivity/N%d/' ...
                                'K%d/Space2D/CrecEE%.2fCrecEI%.2fCrecIE%.2fCrecII%.2f/Cij_Matrix.dat'],nbpop,n,K,Sigma(1),Sigma(2),Sigma(3),Sigma(4)) 
        end
    end

    if(strfind(model,'Binary'))
        str_Matrix = sprintf(['../%s/%dpop/Connectivity/N%d/K%d/Ring/Crec%.2f/Cij_Matrix.dat'],model,nbpop,n,K,Sigma) 
    end

    fMatrix = fopen(str_Matrix,'rt') ;
    M = fread(fMatrix,'*int32') ;
    M = reshape(M,N,N) ;
    M = double(M) ;
    size(M) 

    popList = ['E','I','S','X'] ;
    cl = {[1 0 0] [0 0 1] [0 1 0] [0.7 0.7 0.7]} ;
    
    for i=1:nbpop
        for j=1:nbpop
            % meanX = 0 ;
            meanY = 0 ;
                         
            A = M(Cpt(i)+1:Cpt(i+1),Cpt(j)+1:Cpt(j+1)) ; % A(i,j) j Pres to i Post, 

            for k=1:nbN(i)
                % meanX = meanX + sum(A(:,k)) ;
                meanY = meanY + sum(A(k,:)) ;
            end
            
            %fprintf('Average nbPreS %s%s: %.3f %.3f \n',popList(i),popList(j),meanX./nbN(i),meanY./nbN(j))
            fprintf('Average nbPreS %s%s: %.3f \n',popList(j),popList(i),meanY./nbN(j))
            
            for k=1:nbN(i)
                P(i,j,k) = sum(diag(A,-k)) + sum(diag(A,nbN(j)-k)) ; % P(i,j) j to i
            end
        end
    end

    for i=1:nbpop
        for j=1:nbpop            
            
            Pij = squeeze(P(i,j,:))./nbN(j) ;
            Pij = reshape(Pij,sqrtNp(j),sqrtNp(j)) ;
            
            M = Pij ;
            M(1:sqrtNp(j)/2,sqrtNp(j)/2+1:end) = Pij(sqrtNp(j)/2+1:end,1:sqrtNp(j)/2) ;
            M(sqrtNp(j)/2:end,sqrtNp(j)/2:end) = Pij(1:sqrtNp(j)/2+1,1:sqrtNp(j)/2+1) ;
            M(sqrtNp(j)/2:end,1:sqrtNp(j)/2) = Pij(1:sqrtNp(j)/2+1,sqrtNp(j)/2+1:end) ;
            M(1:sqrtNp(j)/2,1:sqrtNp(j)/2+1) = Pij(sqrtNp(j)/2+1:end,sqrtNp(j)/2:end) ;

            M = interp2(M,'cubic') ;

            figname=sprintf('Connection Probability %s%s Sigma %.2f',popList(j),popList(i),Sigma(i)) ;
            fig = figure('Name',figname,'NumberTitle','off') ; hold on ;
            
            imagesc(M) ;
            % circle(100,99,4*Sigma(i)*10) ;
            circle(50,50,Sigma(i)*10) ;
            circle(50,50,3*Sigma(i)*10) ;
            h = colorbar ;

            xlabel('X (mm)')
            ylabel('Y (mm)')

            set(gca,'xtick',linspace(0,length(M(:,1)),3),'xticklabel',{ linspace(0,1,3) })
            set(gca,'ytick',linspace(0,length(M(:,1)),3),'yticklabel',{ linspace(0,1,3) })
            xlim([0 length(M(:,1))])
            ylim([0 length(M(:,1))])

        end
    end
    
    function h = circle(x,y,r)
        hold on ;
        th = 0:pi/50:2*pi;
        xunit = r * cos(th) + x;
        yunit = r * sin(th) + y;
        h = plot(xunit, yunit, '--k','linewidth',1);
    end

end